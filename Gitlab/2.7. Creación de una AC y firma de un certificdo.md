Asumimos que estamos en el directorio  `~/certs/` o similar.

### 1. Creación de la Autoridad Certificadora (AC) Raíz

Bash

```
# 1. Generar la clave privada de la CA (Root CA)
openssl genrsa -out acserver.key 2048

# 2. Generar el certificado raíz (autofirmado) con 10 años de validez
openssl req -new -x509 -days 3650 -key acserver.key -out acserver.pem

# 3. Crear el directorio para la CA en /etc/ssl
sudo mkdir -p /etc/ssl/certs/ca/
sudo cp acserver.pem /etc/ssl/certs/ca/
```

---

### 2. Creación y Firma del Certificado del Servidor

Bash

```
# 1. Generar la clave privada del servidor
openssl genrsa -out apacheserver2.key 2048

# 2. Generar la Solicitud de Firma (CSR) - ¡OJO, hay que asegurarse de usar 'apacheserver2.local' como Common Name!
openssl req -new -key apacheserver2.key -out apacheserver2.csr

# 3. Firmar el CSR con la clave y certificado de la AC
openssl x509 -req -in apacheserver2.csr -CA acserver.pem -CAkey acserver.key -CAcreateserial -out apacheserver2.crt -days 365 -sha256
```

---

### 3. Configuración y Despliegue en Apache

Bash

```
# 1. Copiar los archivos a sus destinos finales con permisos de root
sudo mkdir -p /etc/ssl/private/apacheserver2/
sudo cp apacheserver2.key /etc/ssl/private/apacheserver2/
sudo cp apacheserver2.crt /etc/ssl/certs/

# 2. (OPCIONAL) Eliminar advertencia ServerName global
sudo sh -c 'echo "ServerName 127.0.0.1" >> /etc/apache2/apache2.conf'

# 3. Crear el sitio apacheserver2-ssl.conf
sudo nano /etc/apache2/sites-available/apacheserver2-ssl.conf
```

```xml                           
<VirtualHost *:443>
        ServerAdmin webmaster@localhost
        ServerName apacheserver2.local
        DocumentRoot /var/www/html

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        SSLEngine on
        SSLCertificateFile      /etc/ssl/certs/apacheserver2.crt
        SSLCertificateKeyFile   /etc/ssl/private/apacheserver2/apacheserver2.key
        SSLCACertificateFile /etc/ssl/certs/ca/acserver.pem
</VirtualHost>        

```

```
# 3. Habilitar el sitio apacheserver2-ssl.conf (asume que ya tiene la config correcta)
sudo a2ensite apacheserver2-ssl.conf

# 4. Reiniciar Apache para aplicar la configuración
sudo systemctl restart apache2

# 5. Comprobar la sintaxis de Apache
sudo apache2ctl configtest
```

---

### 4. Intentos de Confianza del Certificado Raíz en Ubuntu/Chrome

Bash

```
# 1. Instalar herramientas de certificados
sudo apt update
sudo apt install ca-certificates libnss3-tools

# 2. Método de importación al almacén del sistema (usado por Firefox)
sudo cp acserver.pem /usr/local/share/ca-certificates/acserver.crt # Renombrado
sudo update-ca-certificates

# 3. Método de importación directa a la base de datos NSS de Chrome (usado en los intentos finales)
NSS_DIR="$HOME/.config/google-chrome/Profile 1" # O Default, si ese es tu perfil activo
certutil -d "$NSS_DIR" -A -t "CT,," -n "acserver.local - Mi CA Raiz" -i acserver.pem

# 4. Forzar el cierre de Chrome para que recargue la base de datos
pkill chrome
```